> 垂直拆分

垂直拆分是指数据表列的拆分，把一张列比较多的表拆分为多张表，垂直拆分更多时候就应该在数据表设计之初就执行的步骤，然后查询的时候用jion关键起来即可。==垂直拆分解决表与表之间的io竞争==。

![image-20210717103443629](https://file-ykq.oss-cn-shanghai.aliyuncs.com/img/20210717103449.png)

- 通常我们按以下原则进行垂直拆分:

* 把不常用的字段单独放在一张表;

- 把text，blob等大字段拆分出来放在附表中;

- 经常组合查询的列放在一张表中;

优点：
    1、拆分后业务清晰，拆分规则明确。
    2、系统之间整合或扩展容易。
    3、数据维护简单。

缺点：
    1、部分业务表无法join，只能通过接口方式解决，提高了系统复杂度。
    2、受每种业务不同的限制存在单库性能瓶颈，不易数据扩展跟性能提高。
    3、事务处理复杂。

> 水平拆分

水平拆分是指数据表行的拆分，表的行数超过200万行时，就会变慢，这时可以把一张的表的数据拆成多张表来存放，==水平拆分解决单表中数据量增长出现的压力==。

![image-20210717103636835](https://file-ykq.oss-cn-shanghai.aliyuncs.com/img/20210717103636.png)

**优点：**

　　1. 不存在单库大数据，高并发的性能瓶颈。
　　2. 对应用透明，应用端改造较少。
   3. 按照合理拆分规则拆分，join操作基本避免跨库。
   4. 提高了系统的稳定性跟负载能力。

**缺点：**

　　1. 拆分规则难以抽象。
　　2. 分片事务一致性难以解决。
　　3. 数据多次扩展难度跟维护量极大。
　　4. 跨库join性能较差。

**拆分方案：**
　　范围、枚举、时间、取模、哈希、指定等

通常情况下，我们使用取模的方式来进行表的拆分;比如一张有400W的用户表users，为提高其查询效率我们把其分成4张表

通过用ID取模的方法把数据分散到四张表内Id%4+1 = [1,2,3,4]

然后查询,更新,删除也是通过取模的方法来查询

```mysql
$_GET['id'] = 17,
17%4 + 1 = 2, 
$tableName = 'users'.'2'
Select * from users2 where id = 17;
```

在insert时还需要一张临时表uid_temp来提供自增的ID,该表的唯一用处就是提供自增的ID;

```mysql
insert into uid_temp values(null);
```

得到自增的ID后,又通过取模法进行分表插入，注意,进行水平拆分后的表,字段的列和类型和原表应该是相同的,但是要记得去掉auto_increment自增长





